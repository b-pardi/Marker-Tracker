# Marker-Tracker
### Computer vision scripts intended to track fiducial markers from videos of viscoelastic hydrogels as they expand over time (updated 2/16/24)

# How to Use

## Main UI Instructions
- First run 'install_packages.py'
- If you get an error with this script,
    - In a command prompt, (not anaconda terminal) type 'where python' on windows, or in a mac terminal type 'which python'
    - Copy and paste the full path that it prints out
        - On windows it should look something like: 'C:\<some path stuff>\Python\Python310\python.exe'
        - In spider, go to tools > preferences > python interpreter
        - Select 'Use the following Python interpreter:'
        - Paste in the path you copied earlier from the terminal
        - Click apply and ok, and restart spyder for changes to take effect
- Run 'main.py' upon completion of above
- Click button to select video file
- If needed, select the frames of the video you want tracked by clicking the 'Select start/end frames' button
    - This will open a window to scroll through the video
    - Can use either arrow keys (shift + arrow keys to move 10 frames at a time) or the slider at the bottom of the window
    - Scroll to where you want the tracking to begin and click 'Confirm start frame
    - Repeat for tracking end frame
    - close window and frame selections are saved
- Select either marker tracking or necking point detection
- Specify parameters (detailed below)
- Click submit, each option's process is described below

## Individual Tracking Operation Details
### Marker Tracking
- Tunable parameters include:
    - Size of bounding box (bbox) for tracker (default 20 pixels)
        - bbox should be slightly larger than the object being tracked
        - should capture discernable areas of contrast
    - Choice of tracking algorithm
        - KCF (default): fast and efficient, more stable tracking rigid objects (non deforming)
        - CSRT: slower than KCF and jittery on rigid objects, but can track deformable objects
- After submitting, you'll see window of first frame of the video you selected
- In this window click on the markers you want to track
    - Right click to undo an erroneous selection
- Hit enter to confirm selections and proceed with tracking, or ESC to cancel
    - First window will close, but reopen momentarily, visualizing the tracking process
    - Hit ESC to cancel this process once it begins
- Outputs of the tracking will be saved in 'output/Tracking_Output.csv'

### Necking Point Detection
- Tunable parameters include:
    - % of video width to exclude outter edges of
        - Sometimes lighting effects make the tube at the edges of the video appear narrower than they actually are, effecting the necking point detection
        - This allows the ability to exclude x% of the video from detection, essentially cropping it
        - Full video will still be displayed, but the vertical blue lines will indicate area of consideration
    - Threshold pixel intensity value for frame binarization
        - This is a pixel brightness value from 0-255, where any brightness value below this becomes black (0), any any above becomes white (255)
        - This frame binarization is not displayed, but the edge detection uses these binarized images behind the scenes
- After submitting, just sit back and watch the magic
    - Green lines are detected edges, top and bottom edges are what are looked at vertical distance of necking point
    - blue lines are visualizations of the vertical distances to ensure they are touching the top and bottom green edges
    - red line moving around is tracking the minimum distance
- Outputs are saved to 'output/Necking_Point_Detection.csv'

## After tracking videos, further analysis
### Outlier Removal
- Sometimes necking point or less commonly marker tracker jump around certain points and can skew data
- There is a 'Remove outliers' button which opens a new window prompting choice between available tracking output files
- Marker tracker currently work in progress, will not perform correctly
- Necking point detection will show the radial strain plot (same one generated by Necking point analysis button in main ui)
- It is here that outlier points can be identified and removed
- Simply click on points that are outliers to be removed, the plot will updated with the removed points gone after each click
- selections can be saved or undone via buttons at the top, as nothing is saved until the 'Confirm Removal' button is clicked

### Data Visualization
- Currently 3 analysis buttons are available
- Necking point:
    - 'necking_point_location' plots as a control the horizontal marker location of the necking point (minimum diameter)
    - 'diameter_at_necking_point' plots the length of the vertical red marker from the tracking operation
    - 'radial_strain' plots the radial strain ((R-R0) / R0) where R is the diameter of the necking point and R0 is the initial diameter
- Marker deltas:
    - 'marker_deltas' plots the distance that 2 tracked markers are moving away from eachother
    - 'longitudinal_strain' plots the longitudinal strain ((L-L0) / L0) where L is the distance between the markers at time t and L0 is the initial distance between the markers


### Plot Customizations
- In the plot opts folder there are 2 json files, in order to customize your plot you may edit any variable in the 'plot_customizations.json' file, while the 'default_opts.json' is purely for reference